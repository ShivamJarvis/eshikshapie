{% extends 'lms/base.html' %}
{% load static %}
{% block css %}

<style>

.self-jumb{
    background-image: url('/static/lms/images/course-back.jpg');
    width: 100%;
    background-repeat: no-repeat;
    background-size: cover;
    color: rgb(0, 0, 0);
}

.self-jumb .container h1{
    padding: 15px;
}

.btn-take-course{
    border-radius: 0px!important;
    border: 1px solid #054546;
    background-color: #054546!important;
}
.course-info-row{
    margin-top: 30px;
    background-color: #f2f2f2;
    padding: 15px;
}
.course-info{
    color: grey;
    text-transform: uppercase;
}
</style>

{% endblock %}

{% block body %}


<div class="jumbotron jumbotron-fluid text-center self-jumb">
    <div class="container">
      <h1 class="display-5 pt-5">{{course.course_name}}</h1>
    </div>
  </div>

  <div class="container">
      <div class="row">
          <div class="col-lg-7 col-12">
              <!-- 561x360 -->
              <iframe width="561" height="360" src="{{course.intro_video}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <div class="col-lg-5 col-12">
              <h1 style="font-family: 'Nunito', sans-serif;">{{course.course_name}}</h1>
              <span><i class="fas fa-user-graduate"></i> Enrolled Students : {{enrolled_count}}</span>
              {% if not request.user.is_staff %}
              {% if enrolled.status %}
              <h2 class="mt-3">Already Enrolled</h2>
              {% else %}
              <h2 class="mt-3" style="color: #054546;
              "><strike style="font-size: 22px; color: #928e8e;">&#x20B9;{{course.price}}</strike>  &#x20B9;{{course.special_price}}</h2>
              {% endif %}
              {% if enrolled.status %}
              {% if videos %}
                <div class="row">
                    {% for subject_video in videos %}
                    {% if subject_video.video %}
                    <div class="col-4">
                        <a href="{% url 'video_playlist' course_name=course.course_name course_id=course.id video_id=subject_video.video subject_id=subject_video.subject.id %}" class="btn btn-primary btn-take-course mt-3">Watch Videos of {{subject_video.subject.display_name}}</a>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                {% else %}
                <h3 class="mt-5">Video Coming Soon...</h3>
                {% endif %}
                
                
                {% else %}
                {% if course.message %}
                <h3 class="mt-5 text-danger">{{course.message}}</h3>

              {% else %}
            <a href="#" id='buy_now_btn' class="btn btn-primary btn-take-course mt-3">Take This Course</a>
            {% endif %}
            {% endif %}
            {% else %}
            <h2 class="mt-3">Not For Staff</h2>

                {% endif %}

          </div>
      </div>
      <hr>
  </div>
  <div class="container my-5">
      <div class="row">
          <div class="col-lg-8 col-12">
              <h2>Course Description</h2>
              <hr>
              <p>{{course.description}}</p>
          </div>
          <div class="col-lg-4 col-12" >
            <h2>Course Info</h2>
            <div class="row course-info-row">
                <div class="col-6" >

                    <h6 class="course-info"><i class="fas fa-clock"></i> Duration : </h6>
                    <hr>
                    <h6 class="course-info"><i class="fas fa-globe-europe"></i> Language : </h6>
                   <hr>
                    <h6 class="course-info"><i class="fas fa-chalkboard"></i> Mode : </h6>
                   <hr>
                    <h6 class="course-info"><i class="fas fa-certificate"></i> CERTIFICATE : </h6>
                   <hr>
                    <h6 class="course-info"><i class="fas fa-books"></i> SUBJECTS : </h6>
                 
                </div>
                <div class="col-6">
                    <h6> {{course.duration}} </h6>
                    <hr>
                    <h6>{{course.language}} </h6>
                    <hr>
                    <h6>Online</h6>
                    <hr>
                    {% if not course.has_certificate %}
                    <h6>No</h6>
                    {% else %}
                    <h6>Yes</h6>
                    {% endif %}
                    <hr>
                    {% for subject in subjects %}
                    <h6>{{subject.display_name}}</h6>
                    {% endfor %}
                </div>
            </div>
          </div>
      </div>
      <hr>
  </div>

  <div class="container my-2" >
    <h3 class="my-3">CURRICULUMS</h3>
    {% if course.curriculum %}
    <a href="#" class="btn btn-info">Download Curriculum</a>
    {% endif %}
    <hr>
  </div>

  <div class="container mt-5" > 
      <h4 class="text-secondary">
          About Instructor
      </h4>
      {% for instructor in instructors %}
      <div class="row">
          <div class="col-lg-3 col-12" style=" margin: 30px 0px;">
            <img src="/media/{{instructor.image}}" style="width: 270px;" alt="">
          </div>
          <div class="col-lg-9 col-12" style="margin: 30px 0px;">
            <h1>{{instructor.user.first_name}} {{instructor.user.last_name}}</h1>
            <h5>Experience : {{instructor.year_of_experience}} Years</h5>
            <h5>{{instructor.qualifications}}</h5>
          </div>
      </div>
    {% endfor %}
  </div>

  <div class="container my-5">

    <h2 class="text-secondary">REVIEWS</h2>
    <hr>
    {% if not reviews %}
    <h2 class="text-center text-secondary display-4">No Reviews Yet...</h2>
    
    {% endif %}
    {% for review in reviews %}
    {% if review.is_approved %}
    <p class="my-4" style="border: 1px solid #f2f2f2;"><i class="fas text-secondary fa-user fa-2x"></i><span class="ml-3">{{review.review}}</span><br> <span class="mt-3"><i>By {{review.user.first_name}} {{review.user.last_name}}</i></span></p>
    {% endif %}
    {% endfor %}
  </div>


{% endblock %}


{% block js %}

   <script src="https://js.stripe.com/v3/"></script>
<script>
  const buy_now_button = document.querySelector('#buy_now_btn')

  buy_now_button.addEventListener('click', event => {   
    fetch('/checkout/{{course.id}}/')
    .then((result) => { return result.json() })
    .then((data) => {
      var stripe = Stripe(data.stripe_public_key);

      stripe.redirectToCheckout({
      // Make the id field from the Checkout Session creation API response
      // available to this file, so you can provide it as parameter here
      // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
        sessionId: data.session_id
      }).then(function (result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer
        // using `result.error.message`.
      });
    }) 
  })
</script>

{% endblock %}